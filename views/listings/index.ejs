<% layout("/layouts/boilerplate") -%>

<div class="container mt-3 mb-3">

  <!-- FILTER BAR -->
  <div id="filters" class="d-flex flex-wrap align-items-center py-3 border-bottom">
      <% const filters = [
          { icon: "fa-fire", label: "Trending" },
          { icon: "fa-bed", label: "Rooms" },
          { icon: "fa-mountain-city", label: "Iconic Cities" },
          { icon: "fa-mountain-sun", label: "Mountains" },
          { icon: "fa-brands fa-fort-awesome", label: "Castles" },
          { icon: "fa-snowflake", label: "Arctic" },
          { icon: "fa-campground", label: "Camping" },
          { icon: "fa-cow", label: "Farms" },
          { icon: "fa-igloo", label: "Domes" },
          { icon: "fa-sailboat", label: "Boats" },
      ]; %>

      <% filters.forEach(f => { %>
          <div class="filter text-center">
              <i class="fa-solid <%= f.icon %> fa-lg"></i>
              <br>
              <small><%= f.label %></small>
          </div>
      <% }) %>

      <div class="tax-toggle">
          <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="switchCheckDefault">
              <label class="form-check-label" for="switchCheckDefault">Display total after taxes</label>
          </div>
      </div>
  </div>

  <% if (notFound) { %>
      <div class="alert alert-warning text-center">
          No listings found for "<%= q %>"
      </div>
  <% } %>

  <!-- LISTINGS GRID -->
  <div class="listings-grid">
      <% allListings.forEach(listing => { %>
          <a class="listing-link text-decoration-none" href="/listings/<%= listing._id %>">
              <div class="listing-card">
                  <img src="<%= listing.image.url %>" alt="listing_image">
                  <div class="card-body">
                      <h5 class="card-title fw-bold"><%= listing.title %></h5>
                      <p class="mb-0">
                          <%= listing.price.toLocaleString('de-CH', { style: 'currency', currency: 'CHF', minimumFractionDigits: 0 }) %> / night
                          <i class="tax-info text-muted">&nbsp;+18% GST</i>
                      </p>
                  </div>
              </div>
          </a>
      <% }) %>
  </div>

</div>

<script>
const taxSwitch = document.getElementById("switchCheckDefault");
taxSwitch.addEventListener("change", () => {
    document.querySelectorAll(".tax-info").forEach(info => {
        info.style.display = taxSwitch.checked ? "inline" : "none";
    });
});
</script>